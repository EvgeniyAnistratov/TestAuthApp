# TestAuthApp
Приложение не использует встроенные возможности веб-фреймворка Django для
аутентификации и раграничения прав доступа, не использует готовые решения
аутентификации на основе сессий.

Цель проекта, показать самостоятельную реализацию аутентификации и
разграничений прав доступа.

Backend приложение предоставляет возможности:
 - регистрации новых пользователей
 - аутентификации на основе JWT токенов
 - разграничения прав доступа для пользователей на основе ролей и разрешений
 - публикации статей и комментирования статей
 - публикации постов и комментирования постов
 - модерацию комментариев с помощью роли MODERATOR
 - редактирование статей пользователей с помощью роли EDITOR
 - [редактирование базовых разрешений](docs/api.md#authorization---api-редактирования-прав-доступа)
  с помощью роли ADMIN


## Аутентификация
Аутентификация пользователя выполняется с помощью JWT.
Для работы с JWT используется Redis. JWT управляются с помощью черного и белого списка.
В белый список попадают действительные REFRESH токены пользователей, т.е. токены,
которые еще не использовались. Приложение перемещает REFRESH токен в черный список,
когда пользователь получает новую пару ACCESS и REFRESH токенов, или когда пользователь
выходит из системы. ACCESS токены не хранятся в белом списке. ACCESS токены добавляются
в черный список, когда пользователь выходит из системы.


## Разграничение прав доступа
Разграничение прав доступа реализовано с помощью таблиц:
 - Element - Элемент приложения. Представляет группу конкретных элементов,
  над которыми могут выполняться операции.
 - Role - роль, которая может быть назначена пользователю. Роль содержит разрешения.
 - Permission - разрешения прав доступа для конкреных роли и элемента приложения
 - SpecificElement - конкретный элемент приложения над которым выполняется операция. Он принадлежит
  одному элементу приложения. Записи из этой таблицы используются для динамического определения
  элемента приложения, над которым пользователь производит операцию.

Описание ролей и разрешений см. в разделе ["Разграничение прав доступа"](docs/permissions.md)


## API
Описание API см. в разделе ["API"](docs/api.md)


## Клонирование проекта с git репозитория
```bash
git clone https://github.com/EvgeniyAnistratov/TestAuthApp.git
```


## Переменные окружения
Список ожидаемых переменных окружения, используемых приложением, описан в файле .env.example. Переменные окружения могут
быть настроены в файле .env, для этого нужно скопировать файл .env.example под именем .env и настроить переменные
окружения в этом файле:

```bash
cp .env.example .env
```

Также переменные окружения можно настроить без создания файла ___.env___ в корневой директории проекта. Для этого все
переменные окружения можно настроить как __переменные окружения__ или __переменные оболочки__. Например, с помощью
команды ___export___ (встроенной утилиты оболочки Linux Bash: ___export ENV_NAME=ENV_VALUE___), или другим
доступным способом.<br />

Описание переменных окружения представлено на следующей [странице](docs/environments.md)


## Запуск приложения через docker compose
1. Выполнить настройку переменных окружения (см. раздел [Переменные окружения](#переменные-окружения)).
   Убедиться, что переменные DB_HOST и REDIS_HOST хранят имена сервисов, описанных в docker-compose.yaml
    - DB_HOST=db
    - REDIS_HOST=redis
2. Запустить приложение в контейнере
```bash
docker-compose --env-file .env up
```

## Запуск приложения без docker
Ниже описаны шаги для запуска django приложения. Подразумевается, что сервер БД и Redis уже установлены
или запущены в docker контейнерах.

В проекте используется менеджер пакетов и зависимостей [poetry](https://python-poetry.org/).

Минимальная версия python: 3.11

1. Создание виртуального окружения python
```bash
python3 -m venv .venv
```
2. Активация виртуального окружения
```bash
source .venv/bin/activate
```
3. Обновление __pip__
```bash
python3 -m pip install --upgrade pip
```
4. Установка __poetry__
```bash
pip install poetry
```
5. Может потребоваться обновить __poetry.lock__ файл
```bash
poetry lock
```
6. Установка пакетов и зависимостей
```bash
poetry install --no-root
```
7. Создание файла переменных окружения (подробно см. ["Переменные окружения"](#переменные-окружения))
```bash
cp .env.example .env
```
9. Запуск локального сервера
```bash
python3 auth_app/manage.py runserver
```
